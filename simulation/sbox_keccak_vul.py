STUCK_AT_0 = 0

def a0(x00, x01, x02, x03, x10, x11, x12, x13, x20, x21, x22, x23):
    a00 = x01 ^ x21 ^ (x11 ^ x12 ^ x13) & (x21 ^ x22 ^ x23)
    a01 = x02 ^ x22 ^ (x10 & (x22 ^ x23) ^ x20 & (x12 ^ x13) ^ x10 & x20)
    a02 = x03 ^ x23 ^ (x10 & x21 ^ x20 & x11)
    a03 = x00 ^ x20
    return a00, a01, a02, a03

def a1(x10, x11, x12, x13, x20, x21, x22, x23, x30, x31, x32, x33):
    a10 = x11 ^ x31 ^ (x21 ^ x22 ^ x23) & (x31 ^ x32 ^ x33)
    a11 = x12 ^ x32 ^ (x20 & (x32 ^ x33) ^ x30 & (x22 ^ x23) ^ x20 & x30)
    a12 = x13 ^ x33 ^ (x20 & x31 ^ x30 & x21)
    a13 = x10 ^ x30
    return a10, a11, a12, a13

def a2(x20, x21, x22, x23, x30, x31, x32, x33, x40, x41, x42, x43):
    a20 = x21 ^ x41 ^ (x31 ^ x32 ^ x33) & (x41 ^ x42 ^ x43)
    a21 = x22 ^ x42 ^ (x30 & (x42 ^ x43) ^ x40 & (x32 ^ x33) ^ x30 & x40)
    a22 = x23 ^ x43 ^ (x30 & x41 ^ x40 & x31)
    a23 = x20 ^ x40
    return a20, a21, a22, a23

def a3(x30, x31, x32, x33, x40, x41, x42, x43, x00, x01, x02, x03):
    a30 = x31 ^ x01 ^ x02 ^ x03 ^ (x41 ^ x42 ^ x43) & (x01 ^ x02 ^ x03)
    a31 = x32 ^ x00 ^ (x40 & (x02 ^ x03) ^ x00 & (x42 ^ x43) ^ x40 & x00)
    a32 = x33 ^ (x40 & x01 ^ x00 & x41)
    a33 = x30
    return a30, a31, a32, a33

def a4(x40, x41, x42, x43, x00, x01, x02, x03, x10, x11, x12, x13):
    a40 = x41 ^ x11 ^ (x01 ^ x02 ^ x03) & (x11 ^ x12 ^ x13)
    a41 = x42 ^ x12 ^ (x00 & (x12 ^ x13) ^ x10 & (x02 ^ x03) ^ x00 & x10)
    a42 = x43 ^ x13 ^ (x00 & x11 ^ x10 & x01)
    a43 = x40 ^ x10
    return a40, a41, a42, a43

def sbox_keccak_reference(x00, x01, x02, x03, x10, x11, x12, x13, x20, x21, x22, x23, x30, x31, x32, x33, x40, x41, x42, x43):
    a00, a01, a02, a03 = a0(x00, x01, x02, x03, x10, x11, x12, x13, x20, x21, x22, x23)
    a10, a11, a12, a13 = a1(x10, x11, x12, x13, x20, x21, x22, x23, x30, x31, x32, x33)
    a20, a21, a22, a23 = a2(x20, x21, x22, x23, x30, x31, x32, x33, x40, x41, x42, x43)
    a30, a31, a32, a33 = a3(x30, x31, x32, x33, x40, x41, x42, x43, x00, x01, x02, x03)
    a40, a41, a42, a43 = a4(x40, x41, x42, x43, x00, x01, x02, x03, x10, x11, x12, x13)
    return a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, a30, a31, a32, a33, a40, a41, a42, a43

def sbox_keccak_vulnerable(x00, x01, x02, x03, x10, x11, x12, x13, x20, x21, x22, x23, x30, x31, x32, x33, x40, x41, x42, x43):
    a00, a01, a02, a03 = a0(x00, x01, x02, x03, x10, x11, x12, x13, x20, x21, x22, x23)
    a10, a11, a12, a13 = a1(x10, x11, x12, x13, x20, x21, x22, x23, x30, x31, x32, x33)
    a20, a21, a22, a23 = a2(x20, x21, x22, x23, x30, x31, x32, x33, x40, x41, x42, x43)
    a30, a31, a32, a33 = a3(x30, x31, x32, x33, x40, x41, x42, x43, x00, x01, x02, x03)
    x00 = STUCK_AT_0    
    a40, a41, a42, a43 = a4(x40, x41, x42, x43, x00, x01, x02, x03, x10, x11, x12, x13)
    return a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, a30, a31, a32, a33, a40, a41, a42, a43

